# Feature 0010: Replace Login Page with NG.html Design

## Description

Replace the current login page (`src/pages/Login.tsx`) with the elegant design from `NG.html`. The new page will feature:
- Animated canvas backgrounds (CO2 molecules, trading charts, ecology animations)
- Brand watermark ("Nihao Group")
- Two action buttons: "Enter" (authenticate existing users) and "Request Access" (collect registration data)
- Modal forms for both actions
- Full-screen immersive design with dark theme

When clicking "Enter", users authenticate with username/password credentials. When clicking "Request Access", the form collects Entity, Contact, and Reference fields, stores them in the database, and creates a notification in the platform for administrators.

## Files to Create

### 1. `src/pages/Login.tsx` (Complete Rewrite)
- **Current State**: Minimalist partner selection with conditional form display
- **New Implementation**:
  - Convert NG.html design to React component with TypeScript
  - Implement canvas animations (backgroundCanvas, ecologyCanvas) using React refs and useEffect
  - Create modal components for login and registration forms
  - Integrate with existing `useAuth()` hook for authentication
  - Maintain existing authentication flow (username/password → AuthContext.login)
  - Add form handling for "Request Access" modal (Entity, Contact, Reference)
  - Call new backend API endpoint for access requests
  - Handle loading states and error messages
  - Preserve dark mode compatibility (design is already dark-themed)
  - Ensure responsive behavior matches NG.html media queries

### 2. `backend/models/access_request.py` (New Model)
- **Purpose**: Store access requests from "Request Access" form
- **Fields**:
  - `id`: UUID primary key
  - `entity`: String (company/organization name)
  - `contact`: String (email address)
  - `reference`: String (reference number or code)
  - `status`: Enum ('pending', 'reviewed', 'approved', 'rejected')
  - `created_at`: DateTime (timestamp)
  - `reviewed_at`: DateTime (nullable)
  - `reviewed_by`: String (admin user ID, nullable)
  - `notes`: Text (nullable, for admin notes)
- **Methods**:
  - `to_dict(camel_case=True)`: Serialize to JSON format

### 3. `backend/api/access_requests.py` (New Blueprint)
- **Purpose**: Handle access request endpoints
- **Endpoints**:
  - `POST /api/access-requests`: Create new access request (no authentication required)
    - Body: `{ entity: string, contact: string, reference: string }`
    - Returns: `{ message: string, requestId: string }`
    - Validates required fields and email format
  - `GET /api/admin/access-requests`: List all access requests (admin only)
  - `GET /api/admin/access-requests/<request_id>`: Get specific request (admin only)
  - `POST /api/admin/access-requests/<request_id>/review`: Update request status (admin only)
- **Error Handling**: Standard error responses using `standard_error_response()`

### 4. `backend/models/notification.py` (New Model - Optional)
- **Purpose**: Store platform notifications for admins
- **Fields**:
  - `id`: UUID primary key
  - `type`: Enum ('access_request', 'kyc_submission', 'document_upload', etc.)
  - `title`: String
  - `message`: Text
  - `related_id`: String (UUID of related entity - access request, user, etc.)
  - `is_read`: Boolean (default False)
  - `created_at`: DateTime
  - `read_at`: DateTime (nullable)
- **Note**: If notification system is too complex, can use a simpler approach (e.g., flag on access_request model)

## Files to Modify

### 1. `backend/app.py`
- **Changes**:
  - Import and register new `access_requests_bp` blueprint
  - Add route: `app.register_blueprint(access_requests_bp)`

### 2. `backend/models/__init__.py`
- **Changes**:
  - Export new `AccessRequest` model
  - Export new `Notification` model (if implemented)

### 3. `backend/database.py` (if needed)
- **Changes**:
  - Ensure database initialization includes new tables
  - Tables created automatically via `db.create_all()` in app.py

### 4. `src/services/accessRequestService.ts` (New Service)
- **Purpose**: Frontend service for access request API calls
- **Functions**:
  - `submitAccessRequest(entity: string, contact: string, reference: string): Promise<{ message: string, requestId: string }>`
  - Error handling and API URL configuration

### 5. `src/i18n/locales/en.ts` (and ro.ts, zh.ts)
- **New Translation Keys**:
  - `enter`: "Enter"
  - `requestAccess`: "Request Access"
  - `authenticate`: "Authenticate"
  - `application`: "Application"
  - `entity`: "Entity"
  - `contact`: "Contact"
  - `reference": "Reference"
  - `proceed": "Proceed"
  - `submit": "Submit"
  - `cancel": "Cancel"
  - `accessRequestSubmitted": "Access request submitted successfully"
  - `accessRequestError": "Failed to submit access request. Please try again."
  - `invalidEmail": "Invalid email address"
  - `requiredField": "This field is required"

## Implementation Details

### Canvas Animations
- **Background Canvas**: CO2 molecules, data particles, trading chart lines
- **Ecology Canvas**: Growing tree/branches, leaves, floating particles
- **Implementation**: Use React refs for canvas elements, useEffect for animation loops
- **Performance**: Use `requestAnimationFrame` for smooth animations
- **Cleanup**: Properly clean up animation loops on component unmount

### Modal Management
- **State**: Track which modal is open (`'login' | 'register' | null`)
- **Open/Close**: Functions to show/hide modals with smooth transitions
- **Overlay Click**: Close modal when clicking outside
- **Escape Key**: Close modal on Escape key press
- **Form Submission**: Handle form submit events, prevent default, call API

### Authentication Flow
- **Enter Button**: Opens login modal
- **Login Form**: Username and password fields
- **Submit**: Calls `login(username, password)` from AuthContext
- **Success**: Close modal, navigate to `/dashboard`
- **Error**: Display error message in modal

### Access Request Flow
- **Request Access Button**: Opens registration modal
- **Form Fields**: Entity (text), Contact (email), Reference (text)
- **Validation**: 
  - All fields required
  - Contact must be valid email format
- **Submit**: Call `POST /api/access-requests` endpoint
- **Success**: Show success message, close modal, optionally show confirmation
- **Error**: Display error message in modal

### Database Schema
- **Access Requests Table**: `access_requests`
  - Columns: id, entity, contact, reference, status, created_at, reviewed_at, reviewed_by, notes
  - Indexes: created_at (for sorting), status (for filtering)
- **Notifications Table** (if implemented): `notifications`
  - Columns: id, type, title, message, related_id, is_read, created_at, read_at
  - Indexes: is_read, created_at, type

### Admin Notification
- **On Access Request Creation**: 
  - Create notification record with type 'access_request'
  - Link to access_request via related_id
  - Admin can view pending access requests in admin panel
- **Alternative Simple Approach**: 
  - Add `is_notified` boolean flag to access_request model
  - Admin queries for `status='pending' AND is_notified=False`
  - Mark as notified when admin views it

## Design Preservation

### Visual Elements from NG.html
- **Color Scheme**: Dark theme with CSS variables (--dark-void, --dark-matter, --carbon-gray, etc.)
- **Typography**: Inter font family, specific letter-spacing and font weights
- **Animations**: Fade-in animations for logo, buttons, brand watermark
- **Gradients**: Radial gradients for overlay effects
- **Scanlines**: Subtle scanline effect overlay
- **Brand Watermark**: "Nihao Group" text with gradient and animation
- **Logo Icon**: SVG CO2 molecule animation

### Responsive Behavior
- **Mobile**: Adjust brand watermark size, modal padding, button widths
- **Breakpoint**: 480px (matches NG.html media query)
- **Canvas**: Responsive canvas sizing based on window dimensions

## Integration Points

### Existing Systems
- **AuthContext**: Use existing `login()` function, no changes needed
- **Routing**: Maintain existing route protection logic
- **Navigation**: Redirect to `/dashboard` on successful login
- **Error Handling**: Use existing error message patterns

### New Backend Integration
- **API Endpoint**: `/api/access-requests` (no authentication required)
- **Database**: New table for access requests
- **Admin Panel**: Future enhancement to view/manage access requests

## Testing Considerations

### Frontend
- Test modal open/close functionality
- Test form validation (required fields, email format)
- Test authentication flow (success and error cases)
- Test access request submission (success and error cases)
- Test canvas animations render correctly
- Test responsive behavior on mobile devices
- Test keyboard navigation (Escape to close, Tab order)

### Backend
- Test access request creation with valid data
- Test validation (missing fields, invalid email)
- Test database persistence
- Test admin endpoints (if implemented)
- Test error handling and error responses

## Migration Notes

### Breaking Changes
- Complete replacement of Login.tsx component
- Visual design completely different (but maintains same authentication flow)
- No breaking changes to authentication API or AuthContext

### Data Migration
- No data migration needed (new feature, no existing data)

### Deployment
- Ensure new database tables are created (`db.create_all()` handles this)
- No environment variable changes required
- No configuration changes required

## Future Enhancements

### Phase 2 (Not in Scope)
- Admin panel UI for viewing access requests
- Email notifications to admins on new access requests
- Email confirmation to user on access request submission
- Access request status tracking (pending → reviewed → approved/rejected)
- User account creation workflow from approved access requests

