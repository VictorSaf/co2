# Plan Tehnic: Implementare Dark Mode

## Descriere

Implementarea unei variante dark mode complete pentru interfața grafică a platformei CO2 Trading. Varianta dark va fi disponibilă prin intermediul unui toggle în header și va persista preferința utilizatorului în localStorage. Toate componentele, inclusiv graficele Chart.js, vor suporta dark mode.

## Fișiere și Funcții de Modificat

### Configurare Tailwind CSS

**Fișier**: `tailwind.config.js`

- Adăugare configurare `darkMode: 'class'` pentru activarea dark mode bazat pe clasă
- Tailwind va detecta clasa `dark` pe elementul `<html>` sau `<body>`

### Context pentru Theme Management

**Fișier nou**: `src/context/ThemeContext.tsx`

- Creare context React pentru gestionarea temei (light/dark)
- Funcții:
  - `useTheme()` hook pentru accesarea temei curente
  - `toggleTheme()` pentru schimbarea între light și dark
  - `theme` state care poate fi 'light' sau 'dark'
- Persistență în localStorage cu cheia `theme`
- Inițializare din localStorage sau preferința sistemului (media query `prefers-color-scheme`)

### Actualizare App Root

**Fișier**: `src/App.tsx`

- Învelirea aplicației cu `ThemeProvider` din `ThemeContext`
- Aplicarea clasei `dark` pe elementul root când tema este dark

### Component Header - Toggle Button

**Fișier**: `src/components/Header.tsx`

- Adăugare buton toggle pentru dark mode în zona de acțiuni (lângă selectorul de limbă)
- Utilizare iconițe Heroicons: `SunIcon` pentru light mode, `MoonIcon` pentru dark mode
- Poziționare în meniul desktop și mobile
- Actualizare clase Tailwind pentru suport dark mode:

  - `bg-white` → `bg-white dark:bg-gray-800`
  - `text-gray-900` → `text-gray-900 dark:text-gray-100`
  - `text-gray-500` → `text-gray-500 dark:text-gray-400`
  - `border-gray-300` → `border-gray-300 dark:border-gray-700`
  - `hover:bg-gray-100` → `hover:bg-gray-100 dark:hover:bg-gray-700`
  - `shadow` → `shadow dark:shadow-gray-900/50`
  - Meniu dropdown: `bg-white` → `bg-white dark:bg-gray-800`
  - Link-uri active: `text-gray-900` → `text-gray-900 dark:text-gray-100`
  - Link-uri inactive: `text-gray-500` → `text-gray-500 dark:text-gray-400`

### Actualizare Stiluri Globale

**Fișier**: `src/index.css`

- Verificare că clasele dark mode pentru body sunt corecte
- Actualizare componente `.card` pentru dark mode complet
- Actualizare clase `.input` pentru dark mode (border și text)
- Actualizare clase `.btn-primary` și `.btn-secondary` dacă este necesar

### Actualizare Footer

**Fișier**: `src/App.tsx`

- Actualizare footer: `bg-white` → `bg-white dark:bg-gray-800`
- Actualizare text: `text-gray-500` → `text-gray-500 dark:text-gray-400`

### Pagini - Actualizare Dark Mode

Toate paginile trebuie actualizate cu clase dark mode pentru:

- Background-uri: `bg-gray-100` → `bg-gray-100 dark:bg-gray-900`
- Background-uri carduri: `bg-white` → `bg-white dark:bg-gray-800`
- Text principal: `text-gray-900` → `text-gray-900 dark:text-gray-100`
- Text secundar: `text-gray-600` → `text-gray-600 dark:text-gray-400`
- Text terțiar: `text-gray-500` → `text-gray-500 dark:text-gray-500`
- Border-uri: `border-gray-300` → `border-gray-300 dark:border-gray-700`
- Shadow-uri: `shadow` → `shadow dark:shadow-gray-900/50`
- Hover states: `hover:bg-gray-50` → `hover:bg-gray-50 dark:hover:bg-gray-700`

**Fișiere de actualizat**:

1. `src/pages/Login.tsx`
   - Background pagină: `bg-gray-50` → `bg-gray-50 dark:bg-gray-900`
   - Card login: `bg-white` → `bg-white dark:bg-gray-800`
   - Input-uri: border și text pentru dark mode
   - Text-uri: toate clasele de text pentru dark mode

2. `src/pages/Dashboard.tsx`
   - Background: `bg-gray-100` → `bg-gray-100 dark:bg-gray-900`
   - Carduri overview: `bg-white` → `bg-white dark:bg-gray-800`
   - Text-uri în carduri
   - Chart container: background pentru dark mode

3. `src/pages/Market.tsx`
   - Background: `bg-gray-100` → `bg-gray-100 dark:bg-gray-900`
   - Tabel: `bg-white` → `bg-white dark:bg-gray-800`
   - Header tabel: `text-gray-900` → `text-gray-900 dark:text-gray-100`
   - Rânduri tabel: `divide-gray-300` → `divide-gray-300 dark:divide-gray-700`
   - Modal confirmare: background și text pentru dark mode

4. `src/pages/Portfolio.tsx`
   - Background: `bg-gray-100` → `bg-gray-100 dark:bg-gray-900`
   - Carduri: `bg-white` → `bg-white dark:bg-gray-800`
   - Tabele și liste
   - Butoane și input-uri

5. `src/pages/Emissions.tsx`
   - Background: `bg-gray-100` → `bg-gray-100 dark:bg-gray-900`
   - Carduri: `bg-white` → `bg-white dark:bg-gray-800`
   - Chart-uri și grafice
   - Tabele de date

6. `src/pages/MarketAnalysis.tsx`
   - Background: `bg-gray-100` → `bg-gray-100 dark:bg-gray-900`
   - Carduri: `bg-white` → `bg-white dark:bg-gray-800`
   - Chart-uri multiple (Chart.js)
   - Tabele și statistici

7. `src/pages/About.tsx`
   - Background: `bg-gray-50` → `bg-gray-50 dark:bg-gray-900`
   - Hero section: gradient poate rămâne similar sau ajustat pentru dark mode
   - Carduri: `bg-white` → `bg-white dark:bg-gray-800`
   - Text-uri și secțiuni

### Componente - Actualizare Dark Mode

**Fișiere de actualizat**:

1. `src/components/LivePriceTicker.tsx`
   - Background card: `bg-white` → `bg-white dark:bg-gray-800`
   - Text-uri și indicatori
   - Border-uri și separatori

2. `src/components/ActivityHistory.tsx`
   - Background: `bg-white` → `bg-white dark:bg-gray-800`
   - Lista de activități: item-uri cu dark mode
   - Text-uri și badge-uri

3. `src/components/MarketOffersSync.tsx`
   - Verificare dacă există componente care necesită dark mode

### Chart.js Dark Mode Support

**Fișiere care folosesc Chart.js**:

- `src/pages/Dashboard.tsx`
- `src/pages/Emissions.tsx`
- `src/pages/MarketAnalysis.tsx`

**Modificări necesare**:

- Detecție tema curentă din `ThemeContext`
- Actualizare configurație Chart.js pentru dark mode:

  - `scales.x.grid.color` → culoare adaptată la temă
  - `scales.y.grid.color` → culoare adaptată la temă
  - `scales.x.ticks.color` → culoare text adaptată la temă
  - `scales.y.ticks.color` → culoare text adaptată la temă
  - `plugins.legend.labels.color` → culoare text adaptată la temă
  - `plugins.tooltip.backgroundColor` → background adaptat la temă
  - `plugins.tooltip.titleColor` → culoare titlu adaptată la temă
  - `plugins.tooltip.bodyColor` → culoare body adaptată la temă
  - `plugins.tooltip.borderColor` → culoare border adaptată la temă
- Re-creare chart când tema se schimbă (folosind `useEffect` cu dependență pe tema)

### Traduceri (i18n)

**Fișiere de actualizat**:

- `src/i18n/locales/en.ts`
- `src/i18n/locales/ro.ts`
- `src/i18n/locales/zh.ts`

**Adăugare chei de traducere**:

- `darkMode`: "Dark Mode" / "Mod întunecat" / "深色模式"
- `lightMode`: "Light Mode" / "Mod deschis" / "浅色模式"
- `toggleDarkMode`: "Toggle dark mode" / "Comută modul întunecat" / "切换深色模式"

## Algoritmi și Logică

### Theme Context Logic

1. **Inițializare**:
   - Verificare localStorage pentru cheia `theme`
   - Dacă există, folosește valoarea salvată
   - Dacă nu există, verifică `window.matchMedia('(prefers-color-scheme: dark)')`
   - Dacă preferința sistemului este dark, setează tema la 'dark'
   - Altfel, setează la 'light'

2. **Toggle Theme**:
   - Schimbă tema între 'light' și 'dark'
   - Salvează în localStorage
   - Aplică/elimină clasa `dark` pe elementul `<html>`

3. **Sync cu System Preference**:
   - Ascultă evenimente `change` pe media query `prefers-color-scheme`
   - Actualizează tema dacă utilizatorul nu a setat manual o preferință

### Chart.js Dark Mode Logic

1. **Detecție Tema**:
   - Folosește `useTheme()` hook pentru a obține tema curentă
   - Creează variabile de culoare bazate pe temă:
     - Dark: `gridColor = 'rgba(255, 255, 255, 0.1)'`, `textColor = 'rgba(255, 255, 255, 0.7)'`
     - Light: `gridColor = 'rgba(0, 0, 0, 0.05)'`, `textColor = 'rgba(0, 0, 0, 0.7)'`

2. **Actualizare Chart**:
   - În `useEffect`, adaugă tema ca dependență
   - Când tema se schimbă, actualizează configurația chart-ului
   - Folosește `chartInstance.update()` sau re-creare chart pentru a aplica noile culori

## Considerații de Design

- Culorile primare și secundare rămân neschimbate (indigo și teal)
- Contrast-urile trebuie să respecte WCAG AA minimum
- Border-urile și shadow-urile trebuie să fie vizibile în ambele teme
- Hover states trebuie să fie clare în ambele teme
- Focus states (pentru accesibilitate) trebuie să fie vizibile în ambele teme

## Testare

- Testare toggle dark mode din header
- Testare persistență în localStorage
- Testare sincronizare cu preferința sistemului (la prima încărcare)
- Testare toate paginile în dark mode
- Testare chart-uri în dark mode
- Testare componente interactive (dropdown-uri, modal-uri, tabele)
- Testare responsive (mobile și desktop)
- Testare accesibilitate (contrast, focus states)

## Note Tehnice

- Tailwind CSS suportă nativ dark mode prin clasa `dark:` prefix
- Nu este necesară instalare de dependențe suplimentare
- Chart.js necesită actualizare manuală a culorilor în configurație
- Clasa `dark` trebuie aplicată pe elementul `<html>` pentru ca Tailwind să funcționeze corect
- Preferința sistemului este verificată doar la inițializare, nu se sincronizează automat după (pentru a respecta preferința utilizatorului)
