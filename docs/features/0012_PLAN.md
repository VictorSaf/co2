# Plan: Admin Settings Page

## Descriere

Pagina de settings funcțională pentru utilizatorii cu privilegii de admin (în prezent doar Victor). Pagina va conține trei secțiuni principale:
1. **Management Useri** - gestionarea utilizatorilor platformei
2. **Configurare** - setări generale ale platformei
3. **Monitorizare Actualizare Prețuri** - informații despre sursele de date, librăriile folosite și intervalele de actualizare pentru prețurile EUA și CER

## Context

- Utilizatorul admin este Victor (username: "Victor", password: "VictorVic")
- Autentificarea admin se face prin header `X-Admin-ID` (implementare placeholder pentru development)
- Există deja link către `/settings` în Header component, dar pagina nu există încă
- Prețurile sunt actualizate automat prin polling în frontend și scraping în backend

## Fișiere de Modificat/Creat

### Frontend

#### Nou Fișier: `src/pages/Settings.tsx`
- Pagină principală de settings cu trei secțiuni (tabs sau accordion)
- Verificare dacă utilizatorul este admin (Victor) - dacă nu, redirect către dashboard cu mesaj de eroare
- Secțiunea 1: Management Useri
- Secțiunea 2: Configurare
- Secțiunea 3: Monitorizare Actualizare Prețuri

#### Nou Fișier: `src/services/adminService.ts`
- Funcții pentru apelurile API admin:
  - `getAllUsers()` - listă toți utilizatorii
  - `getUserDetails(userId)` - detalii utilizator
  - `updateUser(userId, data)` - actualizare utilizator
  - `deleteUser(userId)` - ștergere utilizator
  - `getPriceUpdateConfig()` - configurație actualizare prețuri
  - `updatePriceUpdateConfig(config)` - actualizare configurație

#### Nou Fișier: `src/components/admin/UserManagement.tsx`
- Componentă pentru managementul utilizatorilor
- Tabel cu lista utilizatorilor (username, email, KYC status, data creării)
- Filtrare și căutare
- Acțiuni: vizualizare detalii, editare, ștergere
- Modal pentru editare utilizator

#### Nou Fișier: `src/components/admin/Configuration.tsx`
- Componentă pentru configurarea platformei
- Setări generale (nume platformă, email contact, etc.)
- Setări de cache pentru prețuri
- Setări de rate limiting

#### Nou Fișier: `src/components/admin/PriceUpdateMonitoring.tsx`
- Componentă pentru monitorizarea actualizărilor de prețuri
- Afișează informații despre:
  - **EUA Price Updates**:
    - Interval polling: 5 minute (300000ms) - din `src/services/euaPriceService.ts`
    - Cache duration: 120 secunde (2 minute) - din `backend/app.py` (`CACHE_DURATION`)
    - Endpoint: `/api/eua/price`
    - Librării folosite:
      - Backend: `requests`, `beautifulsoup4`, `json`, `re` (din `backend/scraper.py`)
      - Frontend: `axios` (din `src/services/euaPriceService.ts`)
    - Surse de date (în ordine de prioritate):
      1. ICE (Intercontinental Exchange) - spot price
      2. Free API (realistic simulation)
      3. TradingView
      4. Investing.com
      5. MarketWatch
      6. ICE public pages
      7. OilPriceAPI (fallback, dacă există `OILPRICE_API_KEY`)
    - Ultima actualizare: timestamp din ultimul răspuns API
    - Status: indicator dacă scraping-ul funcționează
  - **CER Price Updates**:
    - Interval polling: 5 minute (300000ms) - din `src/services/cerPriceService.ts`
    - Cache duration: 120 secunde (2 minute) - din `backend/app.py` (`CACHE_DURATION`)
    - Endpoint: `/api/cer/price`
    - Librării folosite:
      - Backend: `requests`, `beautifulsoup4`, `json`, `re` (din `backend/scraper.py`)
      - Frontend: `axios` (din `src/services/cerPriceService.ts`)
    - Metodă: Generat pe baza prețului EUA (discount 30-50%)
    - Ultima actualizare: timestamp din ultimul răspuns API
    - Status: indicator dacă generarea funcționează
  - **Historical Data Collector**:
    - Librării: `requests`, `BeautifulSoup`, `json` (din `backend/historical_data_collector.py`)
    - Metodă: Generare date istorice realiste bazate pe tendințe de piață
    - Fișiere: `backend/data/historical_eua.json`, `backend/data/historical_cer.json`
- Buton pentru refresh manual al prețurilor
- Log-uri ale ultimelor actualizări (opțional)

#### Modificare: `src/App.tsx`
- Adăugare rută pentru `/settings` cu `ProtectedRoute` wrapper
- Verificare suplimentară pentru admin în componenta Settings

#### Modificare: `src/context/AuthContext.tsx`
- Adăugare funcție `isAdmin()` care verifică dacă utilizatorul curent este Victor
- Adăugare câmp `isAdmin` în context

#### Modificare: `src/i18n/locales/en.ts`, `ro.ts`, `zh.ts`
- Adăugare chei de traducere pentru:
  - `settings`, `userManagement`, `configuration`, `priceUpdateMonitoring`
  - `users`, `userDetails`, `editUser`, `deleteUser`
  - `priceUpdateInterval`, `cacheDuration`, `dataSources`, `libraries`, `lastUpdate`
  - `euaPrice`, `cerPrice`, `historicalData`
  - `refreshPrices`, `manualRefresh`

### Backend

#### Nou Fișier: `backend/api/admin_users.py`
- Blueprint pentru managementul utilizatorilor
- Endpoints:
  - `GET /api/admin/users` - listă toți utilizatorii (cu paginare, filtrare)
  - `GET /api/admin/users/<user_id>` - detalii utilizator
  - `PUT /api/admin/users/<user_id>` - actualizare utilizator
  - `DELETE /api/admin/users/<user_id>` - ștergere utilizator
- Toate endpoint-urile protejate cu `@require_admin` decorator

#### Nou Fișier: `backend/api/admin_config.py`
- Blueprint pentru configurarea platformei
- Endpoints:
  - `GET /api/admin/config` - obține configurația curentă
  - `PUT /api/admin/config` - actualizare configurație
  - `GET /api/admin/config/price-updates` - configurație specifică pentru actualizări prețuri
  - `PUT /api/admin/config/price-updates` - actualizare configurație prețuri
- Toate endpoint-urile protejate cu `@require_admin` decorator

#### Modificare: `backend/app.py`
- Înregistrare blueprint-uri noi: `admin_users_bp`, `admin_config_bp`
- Endpoint nou: `GET /api/admin/price-updates/status` - status actualizări prețuri
  - Returnează informații despre ultimele actualizări, surse folosite, status

#### Modificare: `backend/utils/helpers.py`
- Funcție helper `is_victor_admin(admin_id)` - verifică dacă admin_id corespunde cu Victor
- Poate folosi UUID-ul consistent generat pentru Victor din frontend

## Detalii Tehnice

### Verificare Admin

- În frontend, verificare în `Settings.tsx` dacă `user.username === 'Victor'`
- Dacă nu este admin, redirect către dashboard cu mesaj de eroare
- În backend, toate endpoint-urile admin verifică `X-Admin-ID` header și pot verifica dacă este Victor

### Management Useri

- Lista utilizatorilor din baza de date (`User` model)
- Afișare: username, email, KYC status, data creării, ultima activitate
- Filtrare după: KYC status, risk level, data creării
- Căutare după: username, email
- Acțiuni disponibile:
  - Vizualizare detalii complete (KYC info, documente, etc.)
  - Editare informații de bază (email, company_name, etc.)
  - Ștergere utilizator (cu confirmare)

### Configurare

- Setări generale ale platformei
- Configurare cache duration pentru prețuri
- Configurare rate limiting
- Configurare surse de date pentru prețuri (prioritizare)
- Setări de email/notificări

### Monitorizare Actualizare Prețuri

- Afișare informații statice despre configurația curentă:
  - Intervalele de polling (5 minute pentru EUA și CER)
  - Durata cache-ului (120 secunde)
  - Librăriile folosite (requests, beautifulsoup4, json, re pentru backend; axios pentru frontend)
  - Sursele de date în ordinea priorității
- Afișare informații dinamice:
  - Ultima actualizare EUA (timestamp)
  - Ultima actualizare CER (timestamp)
  - Status scraping (success/failure)
  - Sursa folosită pentru ultima actualizare
- Buton pentru refresh manual care apelează `POST /api/eua/price/refresh` și `/api/cer/price` (dacă există endpoint pentru CER refresh)

## Structură Date

### Response API pentru Price Updates Status

```json
{
  "eua": {
    "pollingInterval": 300000,
    "cacheDuration": 120,
    "endpoint": "/api/eua/price",
    "libraries": {
      "backend": ["requests", "beautifulsoup4", "json", "re"],
      "frontend": ["axios"]
    },
    "dataSources": [
      "ICE (Intercontinental Exchange)",
      "Free API (realistic simulation)",
      "TradingView",
      "Investing.com",
      "MarketWatch",
      "ICE public pages",
      "OilPriceAPI (fallback)"
    ],
    "lastUpdate": "2025-01-XX...",
    "lastSource": "Free API",
    "status": "success"
  },
  "cer": {
    "pollingInterval": 300000,
    "cacheDuration": 120,
    "endpoint": "/api/cer/price",
    "libraries": {
      "backend": ["requests", "beautifulsoup4", "json", "re"],
      "frontend": ["axios"]
    },
    "method": "Generated based on EUA price (30-50% discount)",
    "lastUpdate": "2025-01-XX...",
    "status": "success"
  },
  "historical": {
    "libraries": ["requests", "BeautifulSoup", "json"],
    "method": "Realistic generation based on market trends",
    "dataFiles": [
      "backend/data/historical_eua.json",
      "backend/data/historical_cer.json"
    ]
  }
}
```

## UI/UX

- Design consistent cu restul aplicației (dark mode support)
- Tabs sau accordion pentru cele trei secțiuni principale
- Tabel responsive pentru lista utilizatorilor
- Cards pentru informații despre actualizări prețuri
- Indicatori vizuali pentru status (success/error icons)
- Loading states pentru operațiuni asincrone
- Confirmări pentru acțiuni destructive (ștergere utilizator)

## Securitate

- Toate endpoint-urile admin protejate cu `@require_admin` decorator
- Verificare suplimentară în frontend că utilizatorul este Victor
- Validare input pentru toate operațiunile de editare
- Rate limiting pe endpoint-urile admin (moștenit din configurația globală)

## Note

- Informațiile despre librării și surse sunt hardcodate în plan pentru claritate, dar vor fi extrase din codul existent
- Configurația actualizărilor de prețuri este în mare parte statică (intervalele sunt hardcodate în cod), dar poate fi făcută configurabilă în viitor
- Managementul utilizatorilor va folosi modelul `User` existent din `backend/models/user.py`
- Pentru verificarea dacă utilizatorul este Victor, se poate folosi username-ul sau se poate crea un câmp `is_admin` în modelul User (dar pentru moment doar Victor este admin)

