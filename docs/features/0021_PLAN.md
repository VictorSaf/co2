# Plan: Allow Document Upload from All Onboarding Pages

## Description

Currently, users can only upload documents on the first page (`document_collection` step) of the onboarding process, and they cannot proceed to subsequent pages without uploading all required documents. This plan addresses both issues:

1. **Remove blocking validation**: Allow users to proceed through all onboarding pages even if they haven't uploaded all required documents yet
2. **Enable document uploads on all pages**: Add document upload capability to all onboarding steps so users can upload documents at any point in the process

## Current Behavior

- Document uploads are only available on the `document_collection` step
- The "Continue to Next Step" button is only enabled when `hasAllRequiredDocuments()` returns `true`
- Users see a message "Please upload all required documents to continue" if they haven't uploaded all documents
- This prevents users from accessing other onboarding pages (EU ETS verification, suitability assessment, appropriateness assessment, final review)

## Required Changes

### 1. Remove Blocking Validation (`src/pages/Onboarding.tsx`)

**Location**: Lines 508-530

**Current Code**:
- Button to continue is conditionally rendered based on `hasAllRequiredDocuments()`
- If documents are missing, shows a disabled message instead of the button

**Change Required**:
- Always show the "Continue to Next Step" button, regardless of document upload status
- Optionally show a warning message indicating which documents are still missing, but don't block navigation
- Keep the document count display for user awareness

**Implementation**:
- Remove the conditional rendering of the button
- Always render the button with `onClick={() => setCurrentStep('eu_ets_verification')}`
- Add an optional informational message showing missing documents (non-blocking)

### 2. Add Document Upload Section to Other Steps

**Locations**: 
- `eu_ets_verification` step (around line 534)
- `suitability_assessment` step (around line 552)
- `appropriateness_assessment` step (around line 572)
- `final_review` step (around line 592)

**Implementation Options**:

**Option A: Collapsible Document Upload Section**
- Add a collapsible/expandable section titled "Upload Documents" on each step
- When expanded, shows all document upload components (same as `document_collection` step)
- Default state: collapsed (to not overwhelm users)
- Shows count of uploaded documents in the header

**Option B: Link to Document Step**
- Add a button/link on each step that says "Upload Documents" or "Manage Documents"
- Clicking it navigates back to the `document_collection` step
- User can then navigate back to their current step

**Option C: Sidebar/Sticky Document Upload Panel**
- Add a persistent sidebar or sticky panel that shows document upload status
- Always visible on all steps
- Shows which documents are uploaded and which are missing
- Allows quick uploads without leaving current step

**Recommended**: Option A (Collapsible Section) - Provides best UX balance between accessibility and not overwhelming the interface

### 3. Update Document Loading Logic

**Location**: `src/pages/Onboarding.tsx` lines 88-101

**Current Behavior**:
- Documents are only reloaded when `currentStep === 'document_collection'`

**Change Required**:
- Reload documents on all steps, not just `document_collection`
- This ensures document lists stay up-to-date when users upload from other pages

**Implementation**:
- Remove the condition `currentStep === 'document_collection'` from the useEffect
- Reload documents whenever `currentStep` changes or `kycData` updates

### 4. Update Final Review Step Validation

**Location**: `src/pages/Onboarding.tsx` line 629

**Current Behavior**:
- Submit button is disabled if `!hasAllRequiredDocuments()`

**Change Required**:
- Keep the validation for final submission (users should have all documents before submitting)
- This is the only place where document validation should block the user
- Show clear error message if submission attempted without all documents

**Implementation**:
- Keep the `disabled={!hasAllRequiredDocuments() || ...}` condition
- Add a clear error message explaining which documents are missing if user tries to submit

### 5. Update Stepper Navigation

**Location**: `src/components/onboarding/OnboardingStepper.tsx` (if it exists)

**Current Behavior**:
- May restrict navigation between steps

**Change Required**:
- Allow users to click on any step in the stepper to navigate to it
- Don't enforce sequential navigation
- Visual indication of which steps are complete vs incomplete

**Implementation**:
- Make stepper steps clickable
- Allow navigation to any step
- Show visual indicators (checkmarks, progress) for completed steps

## Files to Modify

1. **`src/pages/Onboarding.tsx`**
   - Remove blocking validation on `document_collection` step (lines 508-530)
   - Add document upload section to other steps (lines 534, 552, 572, 592)
   - Update document reloading logic (lines 88-101)
   - Keep final review validation (line 629)

2. **`src/components/onboarding/OnboardingStepper.tsx`** (if exists)
   - Make steps clickable for navigation
   - Add visual indicators for step completion

## Implementation Details

### Document Upload Component Reuse

The `DocumentUpload` component is already designed to be reusable. It accepts:
- `documentType`: The type of document
- `existingDocuments`: Array of all documents (filtered internally)
- `onUploadSuccess`: Callback when upload succeeds
- `onDelete`: Callback when document is deleted

We can reuse this component on all steps by:
1. Passing the same `documents` state array
2. Using the same `handleDocumentUpload` and `handleDocumentDelete` handlers
3. Rendering all 5 document types in a collapsible section

### Collapsible Section Implementation

Use a simple state-based collapse/expand:
- State: `const [showDocumentUpload, setShowDocumentUpload] = useState(false)`
- Toggle button: "Upload Documents" / "Hide Document Upload"
- When expanded, render all 5 `DocumentUpload` components
- Show document count in button: "Upload Documents (3/5 uploaded)"

### Navigation Flow

- Users can navigate freely between steps using stepper or buttons
- Document uploads are available on all steps
- Final review step validates that all documents are uploaded before submission
- Users can go back to previous steps to complete missing information

## Testing Considerations

1. **Navigation Testing**:
   - Verify users can navigate to any step without uploading documents
   - Verify users can navigate back and forth between steps
   - Verify stepper allows clicking on any step

2. **Document Upload Testing**:
   - Verify documents can be uploaded from any step
   - Verify document list updates correctly after upload from any step
   - Verify document deletion works from any step
   - Verify multiple documents per type work correctly

3. **Final Submission Testing**:
   - Verify submission is blocked if documents are missing
   - Verify clear error message shows which documents are missing
   - Verify submission succeeds when all documents are uploaded

4. **State Management Testing**:
   - Verify document state persists when navigating between steps
   - Verify document reloading works correctly on all steps
   - Verify no duplicate document entries appear

## User Experience Improvements

1. **Progressive Disclosure**: Collapsible document section prevents overwhelming users while keeping functionality accessible
2. **Flexibility**: Users can complete onboarding in their preferred order
3. **Clear Feedback**: Document count and status visible on all steps
4. **Non-Blocking**: Users can explore all steps before committing to document uploads
5. **Final Validation**: Still ensures compliance by validating documents before final submission

## Edge Cases

1. **User uploads document on step 2, then navigates to step 1**: Document should appear in list
2. **User deletes document on step 3**: Document should disappear from all steps
3. **User navigates to final review without documents**: Should see clear message about missing documents
4. **User tries to submit without documents**: Should see validation error with list of missing documents

