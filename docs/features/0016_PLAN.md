# Plan Feature: Remove PDF Restriction and Display All Uploaded Documents

## Description

Remove the PDF-only restriction for company registration certificate uploads in the onboarding process. Allow users to upload any supported file type (PDF, PNG, JPG, JPEG) for company registration certificates. Additionally, modify the UI to display all uploaded files in their respective categories, not just the most recent one, allowing users to upload multiple files per document category.

## Current Implementation

### Backend Validation
- **File**: `backend/services/document_validator.py`
- **Restriction**: Lines 100-103 enforce PDF-only validation for `company_registration` document type
- **Current behavior**: Rejects any non-PDF file with error "Company registration certificate must be a PDF file"

### File Upload & Storage
- **Backend API**: `backend/api/kyc.py` - `/documents/upload` endpoint (lines 156-309)
- **Current behavior**: Already saves every uploaded file to database as `KYCDocument` record
- **Database model**: `backend/models/kyc_document.py` - No unique constraint on `(user_id, document_type)`, allowing multiple documents per type

### Frontend Display
- **Component**: `src/components/onboarding/DocumentUpload.tsx`
- **Current behavior**: 
  - Line 40: Uses `find()` to get only the first document matching the type
  - Lines 137-163: Shows only one document when `existingDoc` exists
  - Hides upload area when one document exists, preventing multiple uploads
- **Parent component**: `src/pages/Onboarding.tsx` passes `existingDocuments` prop containing all user documents

## Changes Required

### 1. Remove PDF Restriction (Backend)

**File**: `backend/services/document_validator.py`

**Change**: Remove lines 100-103 that enforce PDF-only validation for company registration certificates.

```python
# REMOVE THIS BLOCK:
# For company registration certificate, check if it's PDF
if document_type == 'company_registration':
    if extension != 'pdf':
        return False, "Company registration certificate must be a PDF file"
```

**Result**: Company registration certificates will accept all allowed file types (PDF, PNG, JPG, JPEG) just like other document types.

### 2. Display All Documents Per Category (Frontend)

**File**: `src/components/onboarding/DocumentUpload.tsx`

**Changes**:
- **Line 40**: Change from `find()` to `filter()` to get all documents of the specified type
  - Current: `const existingDoc = existingDocuments.find((doc) => doc.document_type === documentType);`
  - New: `const existingDocs = existingDocuments.filter((doc) => doc.document_type === documentType);`
- **Lines 137-163**: Modify the display logic to show a list of all documents instead of a single document
  - Replace single document display with a list/map of all documents
  - Each document should show: filename, size, verification status, delete button
  - Maintain the same styling and dark mode support
- **Upload area**: Keep upload area visible even when documents exist, allowing multiple uploads per category

**UI Structure**:
- Show list of existing documents (if any) above the upload area
- Each document item displays:
  - Document icon
  - File name
  - File size (KB)
  - Verification status (Verified/Pending/Rejected)
  - Delete button
- Upload area remains visible below the document list

### 3. Ensure Multiple Uploads Work

**Verification**: 
- Backend already supports multiple documents per type (no unique constraint)
- Frontend `handleDocumentUpload` in `Onboarding.tsx` (line 177) already adds new documents to the list
- No changes needed - just ensure UI allows multiple uploads

## Files to Modify

1. `backend/services/document_validator.py` - Remove PDF restriction (lines 100-103)
2. `src/components/onboarding/DocumentUpload.tsx` - Display all documents per type, keep upload area visible

## Files to Review (No Changes Expected)

1. `backend/api/kyc.py` - Already saves all uploads correctly
2. `backend/models/kyc_document.py` - Already supports multiple documents per type
3. `src/pages/Onboarding.tsx` - Already handles multiple documents correctly
4. `src/services/kycService.ts` - Already supports multiple uploads

## Testing Considerations

1. **Upload multiple company registration certificates** with different file types (PDF, PNG, JPG)
2. **Verify all uploaded files appear** in the company registration section
3. **Verify files are saved** to database (check `kyc_documents` table)
4. **Verify delete functionality** works for each individual document
5. **Verify upload area remains visible** after uploading documents
6. **Test with other document types** to ensure no regression

## Notes

- Backend already supports the required functionality (multiple documents per type, all file types)
- Main work is removing the restriction and updating the UI to display all documents
- No database migrations needed
- No API changes needed

